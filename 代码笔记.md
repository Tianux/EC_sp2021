# 代码笔记

1. 代码采取使用结构体分装实现类似对象与类的方法，使用结构体定义类，其成员变量使用结构体变量实现，而成员函数则使用void *定义，实现单独写在.c文件中，由于没有外部引用，代码只能通过结构体保存的地址进行访问。

2. 代码总体上分为三部分，初始化代码、主循环代码、后台中断代码

   1) 初始化代码：

   ​	外设的对象生成和成员变量赋值在对应的.c文件中进行。

   ​	中断等的总初始化代码在[main.c](.\User\main.c)的main()函数中。

   ​		

   ​	关键初始化代码包含以下几个部分

   ​	[TASK_GlobalInit()](./doc/sp_task/TASK_GlobalInit().md)

   ​		全局任务初始化，具体参见文档

   

   

   ​	

   ​	使用结构体表述的各个外设(如CAN,GIMBAL,CHASSIS,SENTRY等，可分为底层、中层、上层)，使用自定义结构体类型(在对应的.h文件中进行定义)描述外设的属性和方法、在对应的.c文件中定义具体的结构体并在定义时初始化(对应成员变量和成员函数赋值)

   2) 主循环代码

   ​	主循环代码并不是在main()中进行，而是使用系统定时器spTIMER的中断实现，其实现周期为1ms触发一次中断

   ​	

   ​	

   3) 后台中断代码

   

   

   

   

   

   ### 尚存疑问：

   ​	射击主循环([Shooting_Control_Looper()](sp_shoot.md))中也有对键位的判断，这部分会不会与主循环([TASK_ControlLooper()](sp_task.md))有重叠呢

   ​	
   
   ​	代码很像很多人独立编写混合在一起，其中有些代码出现了冗余，有些代码出现了编程风格上显著不一致，有些代码使用自编库而另一些没有使用。
   
   ​	主要冲突部分在于LED8_Configurature()代码，LED_R_ON等，多出现在sp_utility.c中
   
   
   
   ​	sp_irq中应用了一种似乎效率不高的中断添加机制，能不能进行一定程度上的修改呢
   
   ​	修改思路如下：
   
   ​		1. 





### 	杂记：

​			激光用到了一些很有趣的代码

```c
			#define LASER_ON()              GPIO_SetBits(GPIOG,GPIO_Pin_13)
			#define LASER_OFF()             GPIO_ResetBits(GPIOG,GPIO_Pin_13)
```

这或许说明了激光的安装针脚





sp_chasis和gimbal都有涉及到sp_shoot，而sp_sentry又涉及到sp_chasis和gimbal，间接嵌套了sp_shoot